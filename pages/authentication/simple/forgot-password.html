<!DOCTYPE html>
<html lang="en-US" dir="ltr">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <!-- ===============================================-->
    <!--    Document Title-->
    <!-- ===============================================-->
    <title>Phoenix</title>


    <!-- ===============================================-->
    <!--    Favicons-->
    <!-- ===============================================-->
    <link rel="apple-touch-icon" sizes="180x180" href="https://deployvr.online/define/assets/img/brand2/centelha.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://deployvr.online/define/assets/img/brand2/centelha.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://deployvr.online/define/assets/img/brand2/centelha.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://deployvr.online/define/assets/img/brand2/centelha.png">
    <link rel="manifest" href="../../../assets/img/favicons/manifest.json">
    <meta name="msapplication-TileImage" content="https://deployvr.online/define/assets/img/brand2/centelha.png">
    <meta name="theme-color" content="#ffffff">
    <script src="../../../vendors/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="../../../vendors/simplebar/simplebar.min.js"></script>
    <script src="../../../assets/js/config.js"></script>


    <!-- ===============================================-->
    <!--    Stylesheets-->
    <!-- ===============================================-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&amp;display=swap" rel="stylesheet">
    <link href="../../../vendors/simplebar/simplebar.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link href="../../../assets/css/theme-rtl.min.css" type="text/css" rel="stylesheet" id="style-rtl">
    <link href="../../../assets/css/theme.min.css" type="text/css" rel="stylesheet" id="style-default">
    <link href="../../../assets/css/user-rtl.min.css" type="text/css" rel="stylesheet" id="user-style-rtl">
    <link href="../../../assets/css/user.min.css" type="text/css" rel="stylesheet" id="user-style-default">
    <script>
      var phoenixIsRTL = window.config.config.phoenixIsRTL;
      if (phoenixIsRTL) {
        var linkDefault = document.getElementById('style-default');
        var userLinkDefault = document.getElementById('user-style-default');
        linkDefault.setAttribute('disabled', true);
        userLinkDefault.setAttribute('disabled', true);
        document.querySelector('html').setAttribute('dir', 'rtl');
      } else {
        var linkRTL = document.getElementById('style-rtl');
        var userLinkRTL = document.getElementById('user-style-rtl');
        linkRTL.setAttribute('disabled', true);
        userLinkRTL.setAttribute('disabled', true);
      }
    </script>
  </head>


  <body>

    <!-- ===============================================-->
    <!--    Main Content-->
    <!-- ===============================================-->
    <main class="main" id="top">
      <div class="container-fluid px-0">
        <div class="container">
          <div class="row flex-center min-vh-100 py-5">
            <div class="col-sm-10 col-md-8 col-lg-5 col-xxl-4"><a class="d-flex flex-center text-decoration-none mb-4" href="../../../index.html">
                <div class="d-flex align-items-center fw-bolder fs-5 d-inline-block"><img src="https://deployvr.online/define/assets/img/brand2/centelha.png" alt="phoenix" width="108" />
                </div>
              </a>
              <div class="px-xxl-5">
                <div class="text-center mb-6">
                  <h4 class="text-1000">Esqueceu sua senha?</h4>
                  <p class="text-700 mb-5">Entre com seu email cadastrado <br class="d-sm-none" />para receber o link recuperação</p>
                  <form id="forgotPasswordForm" class="d-flex align-items-center mb-5">
                    <input class="form-control flex-1" id="email" type="email" placeholder="Email" />
                    <button class="btn btn-primary ms-2" type="submit" value="Enviar Email de Recuperação" >Enviar<span class="fas fa-chevron-right ms-2"></span></button>
                  </form>
                  <a class="fs--1 fw-bold" href="sign-in.html">Fazer Login</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script>
        var navbarTopStyle = window.config.config.phoenixNavbarTopStyle;
        var navbarTop = document.querySelector('.navbar-top');
        if (navbarTopStyle === 'darker') {
          navbarTop.classList.add('navbar-darker');
        }

        var navbarVerticalStyle = window.config.config.phoenixNavbarVerticalStyle;
        var navbarVertical = document.querySelector('.navbar-vertical');
        if (navbarVertical && navbarVerticalStyle === 'darker') {
          navbarVertical.classList.add('navbar-darker');
        }
      </script>

    </main>
    <!-- ===============================================-->
    <!--    End of Main Content-->
    <!-- ===============================================-->





    <!-- ===============================================-->
    <!--    JavaScripts-->
    <!-- ===============================================-->
    <script src="../../../vendors/popper/popper.min.js"></script>
    <script src="../../../vendors/bootstrap/bootstrap.min.js"></script>
    <script src="../../../vendors/anchorjs/anchor.min.js"></script>
    <script src="../../../vendors/is/is.min.js"></script>
    <script src="../../../vendors/fontawesome/all.min.js"></script>
    <script src="../../../vendors/lodash/lodash.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=window.scroll"></script>
    <script src="../../../vendors/list.js/list.min.js"></script>
    <script src="../../../vendors/feather-icons/feather.min.js"></script>
    <script src="../../../vendors/dayjs/dayjs.min.js"></script>
    <script src="../../../assets/js/phoenix.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/aws-sdk/2.395.0/aws-sdk.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@4.5.3/dist/amazon-cognito-identity.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>




    <script>
      const poolData = {
          UserPoolId: 'us-east-1_BaiGmcUff', // Seu User Pool ID aqui
          ClientId: '26mu8coq65rn4pvl06eturijqh' // Seu Client ID aqui
      };
      const userPool = new AmazonCognitoIdentity.CognitoUserPool(poolData);



      $('#forgotPasswordForm').submit(function(event) {
    event.preventDefault();
    var email = $('#email').val();

    var userData = {
      Username: email,
      Pool: userPool
    };
    var cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

    cognitoUser.forgotPassword({
      onSuccess: function (result) {
        console.log('Sucesso: ', result);
        alert('Um email de recuperação foi enviado para o endereço fornecido.');
      },
      onFailure: function(err) {
        console.log('Erro: ', err);
        alert('Ocorreu um erro ao enviar o email de recuperação. Verifique se o endereço de email está correto e tente novamente.');
      },
      inputVerificationCode() {
        var verificationCode = prompt('Por favor, insira o código de verificação enviado para o seu email.');
        var newPassword = prompt('Por favor, insira sua nova senha.');
        cognitoUser.confirmPassword(verificationCode, newPassword, this);
      }
    });
  });


      function redirectToAuthenticatedPage(name) {
          document.getElementById('authenticatedContent').style.display = 'block';
          document.getElementById('loggedInUserName').textContent = name;
          document.getElementById('loginForm').style.display = 'none';
          checkAuthentication();
             // Redirecionar para outra página


      }

      function displayErrorMessage(message) {
          const errorContainer = document.getElementById('errorContainer');
          errorContainer.innerHTML = '';
          const errorMessage = document.createElement('p');
          errorMessage.textContent = message;
          errorContainer.appendChild(errorMessage);
          errorContainer.style.display = 'block';
      }

      function checkAuthentication() {
          const loggedInUser = localStorage.getItem('loggedInUser');
          const searchForm = document.getElementById('searchForm');
          const signupMessage = document.getElementById('signupMessage');
          const tableLog = document.getElementById('authenticatedContent');
          const signupMessageonline = document.getElementById('signupMessageonline');

          if (!loggedInUser) {
              searchForm.style.display = 'none';
              signupMessage.style.display = 'block';
              signupMessageonline.style.display = 'none';
          } else {
              searchForm.style.display = 'block';
              signupMessage.style.display = 'none';
              tableLog.style.display = 'block';
              signupMessageonline.style.display = 'block';
              // Redirecionar para outra página

          }
      }



      window.addEventListener('load', function () {
          checkAuthentication();
      });

      setInterval(function () {
    const loggedInUser = localStorage.getItem('loggedInUser');
    if (loggedInUser) {
        window.location.assign('../../../adm.php');  // ou window.location.replace('outra-pagina.html');
    }
}, 1000);  // verifica a cada 1000 milissegundos (1 segundo)



function logout() {
      if (cognitoUser) {
        cognitoUser.signOut();
        console.log('Usuário desconectado com sucesso.');
        alert('Você foi desconectado com sucesso.');
        // Adicione redirecionamento para a página de login, se necessário.
      } else {
        console.log('Nenhum usuário conectado.');
        alert('Nenhum usuário conectado.');
      }
    }

      function executeGraphQLQuery(authToken, searchTerms) {
          const query = `
              query MyQuery {
                  search(search: "${searchTerms}") {
                      name
                      institution
                      leaders
                      field
                      productivity
                      country
                      description
                      title
                      link
                  }
              }
          `;
          const graphqlEndpoint = 'https://alprko6tgjdincp4yvnavge7cm.appsync-api.us-east-1.amazonaws.com/graphql'; // Substitua pelo URL do seu endpoint GraphQL

          const headers = {
              Authorization: authToken,
              'Content-Type': 'application/json'
          };

          fetch(graphqlEndpoint, {
              method: 'POST',
              headers: headers,
              body: JSON.stringify({
                  query: query
              })
          })
              .then((response) => response.json())
              .then((data) => {
                  const tableBody = document.querySelector('#table tbody');
                  tableBody.innerHTML = '';

                  data.data.search.forEach((item) => {
                      const row = document.createElement('tr');
                      row.innerHTML = `
                          <td>${item.name}</td>
                          <td>${item.institution}</td>
                          <td>${item.leaders}</td>
                          <td>${item.field}</td>
                          <td>${item.productivity}</td>
                          <td>${item.country}</td>
                          <td>${item.description}</td>
                          <td>${item.title}</td>
                          <td>${item.link}</td>
                      `;
                      tableBody.appendChild(row);
                  });

                  $('#table').bootstrapTable('refreshOptions', {
                      data: data.data.search
                  }).bootstrapTable('refresh');
              })
              .catch((error) => {
                  console.error('Error executing GraphQL query:', error);
              });
      }

      window.addEventListener('load', function () {
          const loggedInUser = localStorage.getItem('loggedInUser');
          if (loggedInUser) {
              redirectToAuthenticatedPage(loggedInUser);

              const cognitoUser = userPool.getCurrentUser();
              if (cognitoUser) {
                  cognitoUser.getSession(function (err, session) {
                      if (err) {
                          displayErrorMessage(err.message || 'Ocorreu um erro durante o login.');
                          return;
                      }
                      const authToken = session.getIdToken().getJwtToken();

                      document.getElementById('searchForm').addEventListener('submit', function (e) {
                          e.preventDefault();
                          const searchTerm = document.getElementById('searchTerm').value;
                          executeGraphQLQuery(authToken, searchTerm);
                      });

                      executeGraphQLQuery(authToken, '');
                  });
              }
          }
      });

      document.getElementById('loginForm').addEventListener('submit', function (e) {
          e.preventDefault();
          const username = document.getElementById('username').value;
          const password = document.getElementById('password').value;

          const authenticationData = {
              Username: username,
              Password: password
          };
          const authenticationDetails = new AmazonCognitoIdentity.AuthenticationDetails(authenticationData);

          const userData = {
              Username: username,
              Pool: userPool
          };
          const cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);

          cognitoUser.authenticateUser(authenticationDetails, {
              onSuccess: function (result) {
                  const accessToken = result.getAccessToken().getJwtToken();
                  const name = result.getIdToken().payload.name;

                  localStorage.setItem('loggedInUser', name);

                  redirectToAuthenticatedPage(name);
              },
              onFailure: function (err) {
                  displayErrorMessage(err.message || 'Ocorreu um erro durante o login.');
              }
          });
      });

      document.getElementById('logoutButton').addEventListener('click', logout);




  </script>

  </body>

</html>